"""Задача 9
Составление рекомендаций по матрице рейтингов

В этом задании вы будете использовать матрицу рейтингов для
составления предсказания пользовательских предпочтений.

Что нужно сделать:
1.	Используя библиотеку Scikit-learn, разложите матрицу
    рейтингов на сингулярные значения с помощью метода SVD

2.	Для выбранного пользователя user_id = 2 из матрицы рейтингов
    предскажите рейтинг для товара item_id = 4 с точностью до десятых
    на основе полученных после разложения матрицы сингулярных значений"""

import numpy as np


# Создаем матрицу рейтингов пользователей и товаров
R = np.array([[3, 1, 2, 3], [4, 3, 4, 3], [2, 2, 1, 5], [1, 5, 5, 2]])

# Для примера будем считать, что нам нужно предсказать рейтинг для пользователя 2 и товара 4
user_id = 2
item_id = 4

# Ищем среднее значение рейтингов для каждого товара и вычитаем его из матрицы рейтингов
item_means = np.mean(R, axis=0)
R_norm = R - item_means

# Вычисляем сингулярное разложение матрицы рейтингов
U, s, Vt = np.linalg.svd(R_norm)

# Определяем размерность матрицы рейтингов и уменьшаем размерность сингулярным разложением
n_users, n_items = R_norm.shape
n_components = 2
S = np.diag(s)[:, :n_components]
U_red = U[:, :n_components]
Vt_red = Vt[:n_components, :]
R_pred = np.dot(np.dot(U_red.T, S), Vt_red) + item_means

# Округляем предсказание до одной десятой
rating_pred = round(R_pred[user_id - 1, item_id - 1], 1)

print(
    f"Предсказанный рейтинг для пользователя {user_id} и товара {item_id}: {rating_pred}"
)

print(rating_pred == 3.3)
